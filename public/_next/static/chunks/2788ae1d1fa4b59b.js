(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14346,65309,e=>{"use strict";var a=e.i(98631);let s=(0,a.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>s],14346);let t=(0,a.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],65309)},14136,e=>{"use strict";let a=(0,e.i(98631).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>a],14136)},43293,611,e=>{"use strict";var a=e.i(98631);let s=(0,a.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],43293);let t=(0,a.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>t],611)},66974,e=>{"use strict";let a=(0,e.i(98631).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>a],66974)},15682,e=>{"use strict";let a=(0,e.i(98631).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>a],15682)},40916,e=>{"use strict";var a=e.i(87519),s=e.i(86646);e.i(16787);var t=e.i(26791),r=e.i(2163),l=e.i(63917),n=e.i(67559),i=e.i(50736),c=e.i(1257),d=e.i(9165),m=e.i(71798),o=e.i(43293),h=e.i(15682),u=e.i(14136),x=e.i(66974),p=e.i(14346),g=e.i(65309),j=e.i(611),v=e.i(75157);let y={name:"",enabled:!0,addr:"0.0.0.0",port:"7681",command:"/bin/bash",command_args_text:"-l",auth_username:"",auth_password:"",extra_args_text:"",restart_on_save:!1,clear_auth:!1};function _(){let{setLoading:e,loading:_,addToast:f,terminals:w,setTerminals:k,terminalsLoaded:N,setTerminalsLoaded:b}=(0,c.useStore)(),[C,M]=(0,s.useState)(!1),[T,B]=(0,s.useState)(null),[S,I]=(0,s.useState)(y);(0,s.useEffect)(()=>{z()},[]);let z=async()=>{try{let e=await d.api.getTerminals();k(e),b(!0)}catch(e){console.error("Failed to load terminals:",e)}},E=async()=>{e(!0,"save");try{let e={name:S.name.trim()||null,enabled:S.enabled,addr:S.addr.trim(),port:parseInt(S.port),command:S.command.trim(),command_args:S.command_args_text.trim()?S.command_args_text.trim().split(/\s+/):[],auth_username:S.auth_username.trim()||void 0,auth_password:S.auth_password.trim()||void 0,extra_args:S.extra_args_text.trim()?S.extra_args_text.trim().split(/\s+/):[]};if(T){let a={...e};S.auth_password||S.clear_auth||delete a.auth_password,S.auth_username||S.clear_auth||delete a.auth_username,S.clear_auth&&(a.auth_username="",a.auth_password=""),await d.api.updateTerminal(T,a),S.restart_on_save&&await d.api.restartTerminal(T),f({type:"success",message:"终端已更新"})}else await d.api.createTerminal(e),f({type:"success",message:"终端已创建"});M(!1),B(null),I(y),z()}catch(e){f({type:"error",message:e instanceof Error?e.message:"创建失败"})}finally{e(!1)}},P=async a=>{if(confirm("确定要删除此终端配置吗？")){e(!0,"delete");try{await d.api.deleteTerminal(a),f({type:"success",message:"终端已删除"}),z()}catch(e){f({type:"error",message:e instanceof Error?e.message:"删除失败"})}finally{e(!1)}}},q=async(a,s)=>{e(!0,s?"stop":"start");try{s?await d.api.stopTerminal(a):await d.api.startTerminal(a),z()}catch(e){f({type:"error",message:e instanceof Error?e.message:"操作失败"})}finally{e(!1)}},L=async a=>{e(!0,"restart");try{await d.api.restartTerminal(a),f({type:"success",message:"终端已重启"}),z()}catch(e){f({type:"error",message:e instanceof Error?e.message:"重启失败"})}finally{e(!1)}},R=e=>{let a=(e.addr||"").trim(),s=a&&"0.0.0.0"!==a?a:window.location.hostname,t=Number(e.port)||0;if(!t)return"";let r=(e.extra_args||[]).some(e=>e.startsWith("--tls")||e.startsWith("--tls-cert"));return`${r?"https":"http"}://${s}:${t}`},H=e=>{e?(B(e.id),I({name:e.name||"",enabled:e.enabled??!0,addr:e.addr||"0.0.0.0",port:e.port?.toString()||"7681",command:e.command||"/bin/bash",command_args_text:(e.command_args||[]).join(" "),auth_username:e.auth_username||"",auth_password:"",extra_args_text:(e.extra_args||[]).join(" "),restart_on_save:!1,clear_auth:!1})):(B(null),I(y)),M(!0)},A=async()=>{e(!0,"upgrade");try{await d.api.upgradeGotty(),f({type:"success",message:"Gotty 已更新"})}catch(e){f({type:"error",message:e instanceof Error?e.message:"更新失败"})}finally{e(!1)}};return N?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-black",children:"终端"}),(0,a.jsx)("p",{className:"text-slate-500 mt-1",children:"管理 SSH 终端会话"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.Button,{variant:"secondary",onClick:A,loading:_,children:[(0,a.jsx)(x.RefreshCw,{className:"w-4 h-4"}),"更新 Gotty"]}),(0,a.jsxs)(r.Button,{onClick:()=>H(),children:[(0,a.jsx)(o.Plus,{className:"w-4 h-4"}),"添加终端"]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4",children:[w.map(e=>(0,a.jsx)(t.Card,{className:"p-4",hoverEffect:!0,children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-indigo-600/10 flex items-center justify-center",children:(0,a.jsx)(m.Terminal,{className:"w-5 h-5 text-indigo-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-bold",children:e.name||e.id}),(0,a.jsx)(l.Badge,{variant:e.status.running?"success":"default",children:e.status.running?"running":"stopped"})]}),(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["地址: ",e.addr,":",e.port]}),(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["命令: ",e.command||"-"," ",e.command_args?.join(" ")]}),(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["认证: ",e.auth_username||"-"," / ",e.auth_password||"-"]}),e.status.running&&(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["PID: ",e.status.pid||"-"," · 运行: ",(0,v.formatUptime)(e.status.uptime_secs)]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.Button,{variant:"primary",size:"sm",onClick:()=>{let a=R(e);a&&window.open(a,"_blank")},disabled:!R(e),children:[(0,a.jsx)(h.ExternalLink,{className:"w-4 h-4"}),"打开终端"]}),(0,a.jsxs)(r.Button,{variant:"secondary",size:"sm",onClick:()=>L(e.id),children:[(0,a.jsx)(x.RefreshCw,{className:"w-4 h-4"}),"重启"]}),(0,a.jsx)(r.Button,{variant:"secondary",size:"sm",onClick:()=>q(e.id,e.status.running),children:e.status.running?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Square,{className:"w-4 h-4"}),"停止"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Play,{className:"w-4 h-4"}),"启动"]})}),(0,a.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>H(e),children:[(0,a.jsx)(j.Pencil,{className:"w-4 h-4"}),"编辑"]}),(0,a.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>P(e.id),children:(0,a.jsx)(u.Trash2,{className:"w-4 h-4 text-red-500"})})]})]})},e.id)),0===w.length&&(0,a.jsx)(t.Card,{className:"p-12 text-center",children:(0,a.jsx)("p",{className:"text-slate-500",children:"暂无终端配置"})})]}),(0,a.jsx)(n.Modal,{isOpen:C,onClose:()=>M(!1),title:T?"编辑终端":"添加终端",size:"lg",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(i.Input,{label:"名称",placeholder:"My Server",value:S.name,onChange:e=>I({...S,name:e.target.value})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,a.jsx)("input",{type:"checkbox",checked:S.enabled,onChange:e=>I({...S,enabled:e.target.checked})}),S.enabled?"已启用":"未启用"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(i.Input,{label:"绑定地址",placeholder:"127.0.0.1",value:S.addr,onChange:e=>I({...S,addr:e.target.value})}),(0,a.jsx)(i.Input,{label:"端口",type:"number",value:S.port,onChange:e=>I({...S,port:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(i.Input,{label:"启动命令",value:S.command,onChange:e=>I({...S,command:e.target.value})}),(0,a.jsx)(i.Input,{label:"命令参数",value:S.command_args_text,onChange:e=>I({...S,command_args_text:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(i.Input,{label:"认证用户名",placeholder:T?"留空保持不变":"可选",value:S.auth_username,onChange:e=>I({...S,auth_username:e.target.value})}),(0,a.jsx)(i.Input,{label:"认证密码",placeholder:T?"留空保持不变":"可选",value:S.auth_password,onChange:e=>I({...S,auth_password:e.target.value})})]}),(0,a.jsx)(i.Input,{label:"额外参数",value:S.extra_args_text,onChange:e=>I({...S,extra_args_text:e.target.value})}),T&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:S.restart_on_save,onChange:e=>I({...S,restart_on_save:e.target.checked})}),"保存后重启"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:S.clear_auth,onChange:e=>I({...S,clear_auth:e.target.checked})}),"清除认证"]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)(r.Button,{variant:"secondary",onClick:()=>M(!1),children:"取消"}),(0,a.jsx)(r.Button,{onClick:E,loading:_,children:"保存"})]})]})})]}):(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-600/30 border-t-indigo-600 rounded-full animate-spin mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-slate-500",children:"加载中..."})]})})}e.s(["default",()=>_])}]);