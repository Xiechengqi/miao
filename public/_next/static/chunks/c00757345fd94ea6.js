(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14346,65309,e=>{"use strict";var s=e.i(98631);let a=(0,s.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>a],14346);let t=(0,s.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],65309)},14136,e=>{"use strict";let s=(0,e.i(98631).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],14136)},43293,611,e=>{"use strict";var s=e.i(98631);let a=(0,s.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],43293);let t=(0,s.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>t],611)},66974,e=>{"use strict";let s=(0,e.i(98631).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],66974)},24392,e=>{"use strict";let s=(0,e.i(98631).default)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);e.s(["Activity",()=>s],24392)},94199,e=>{"use strict";var s=e.i(87519),a=e.i(86646);e.i(16787);var t=e.i(26791),r=e.i(2163),l=e.i(63917),n=e.i(67559),i=e.i(50736),o=e.i(1257),c=e.i(9165),d=e.i(43293),p=e.i(14346),m=e.i(65309),h=e.i(14136),_=e.i(66974),u=e.i(24392);let x=(0,e.i(98631).default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var g=e.i(611);let v={name:"",enabled:!0,mode:"single",local_addr:"127.0.0.1",local_port:"22",remote_bind_addr:"127.0.0.1",remote_port:"",allow_public_bind:!1,ssh_host:"",ssh_port:"22",username:"",auth_type:"password",password:"",private_key_path:"",private_key_passphrase:"",clear_private_key_passphrase:!1,strict_host_key_checking:!1,host_key_fingerprint:"",connect_timeout_ms:"",keepalive_interval_ms:"",backoff_base_ms:"",backoff_max_ms:"",scan_interval_ms:"",debounce_ms:"",exclude_ports_text:""};function b(){let{setLoading:e,loading:b,addToast:y,tcpTunnels:f,setTcpTunnels:j,tcpTunnelsLoaded:k,setTcpTunnelsLoaded:w,tcpTunnelsSupported:N,setTcpTunnelsSupported:C}=(0,o.useStore)(),[S,T]=(0,a.useState)(!1),[I,M]=(0,a.useState)(null),[B,z]=(0,a.useState)(v),[P,H]=(0,a.useState)("single");(0,a.useEffect)(()=>{A()},[]);let A=async()=>{try{let e=await c.api.getTcpTunnels();j(e),w(!0)}catch(e){console.error("Failed to load tunnels:",e),C(!1)}},E=(0,a.useMemo)(()=>f.filter(e=>e.mode===P),[f,P]),K=e=>{if(!e.trim())return;let s=Number(e);return Number.isNaN(s)?void 0:s},q=async()=>{e(!0,"save");try{let e={name:B.name.trim()||null,enabled:B.enabled,mode:B.mode,remote_bind_addr:B.remote_bind_addr,ssh_host:B.ssh_host.trim(),ssh_port:parseInt(B.ssh_port)||22,username:B.username.trim(),auth_type:B.auth_type,strict_host_key_checking:B.strict_host_key_checking,host_key_fingerprint:B.host_key_fingerprint.trim()||void 0};if("single"===B.mode)e.local_addr=B.local_addr.trim(),e.local_port=parseInt(B.local_port)||0,e.remote_port=K(B.remote_port),e.allow_public_bind=B.allow_public_bind;else{var s;e.scan_interval_ms=K(B.scan_interval_ms),e.debounce_ms=K(B.debounce_ms),e.exclude_ports=(s=B.exclude_ports_text).trim()?s.split(/[\s,]+/).map(e=>e.trim()).filter(e=>e.length>0).map(e=>Number(e)).filter(e=>!Number.isNaN(e)):[]}"password"===B.auth_type?B.password.trim()&&(e.password=B.password.trim()):(e.private_key_path=B.private_key_path.trim(),B.clear_private_key_passphrase?(e.clear_private_key_passphrase=!0,e.private_key_passphrase=""):B.private_key_passphrase.trim()&&(e.private_key_passphrase=B.private_key_passphrase.trim()));let a=K(B.connect_timeout_ms);void 0!==a&&(e.connect_timeout_ms=a);let t=K(B.keepalive_interval_ms);void 0!==t&&(e.keepalive_interval_ms=t);let r=K(B.backoff_base_ms);void 0!==r&&(e.backoff_base_ms=r);let l=K(B.backoff_max_ms);void 0!==l&&(e.backoff_max_ms=l),I?(await c.api.updateTcpTunnel(I.id,e),y({type:"success",message:"隧道已更新"})):(await c.api.createTcpTunnel(e),y({type:"success",message:"隧道已创建"})),T(!1),M(null),z(v),A()}catch(e){y({type:"error",message:e instanceof Error?e.message:"操作失败"})}finally{e(!1)}},L=async s=>{let a=s.enabled??"forwarding"===s.status.state;e(!0,a?"stop":"start");try{a?await c.api.stopTcpTunnel(s.id):await c.api.startTcpTunnel(s.id),A()}catch(e){y({type:"error",message:e instanceof Error?e.message:"操作失败"})}finally{e(!1)}},R=async s=>{e(!0,"restart");try{await c.api.restartTcpTunnel(s.id),y({type:"success",message:"隧道已重启"}),A()}catch(e){y({type:"error",message:e instanceof Error?e.message:"重启失败"})}finally{e(!1)}},F=async s=>{e(!0,"test");try{await c.api.testTcpTunnel(s.id),y({type:"success",message:"测试已触发"})}catch(e){y({type:"error",message:e instanceof Error?e.message:"测试失败"})}finally{e(!1)}},O=async s=>{e(!0,"copy");try{await c.api.copyTcpTunnel(s.id),y({type:"success",message:"隧道已复制"}),A()}catch(e){y({type:"error",message:e instanceof Error?e.message:"复制失败"})}finally{e(!1)}},V=async s=>{if(confirm("确定要删除此隧道吗？")){e(!0,"delete");try{await c.api.deleteTcpTunnel(s),y({type:"success",message:"隧道已删除"}),A()}catch(e){y({type:"error",message:e instanceof Error?e.message:"删除失败"})}finally{e(!1)}}},U=e=>{e?(M(e),z({name:e.name||"",enabled:e.enabled??!0,mode:e.mode,local_addr:e.local_addr||"127.0.0.1",local_port:e.local_port?.toString()||"22",remote_bind_addr:e.remote_bind_addr||"127.0.0.1",remote_port:e.remote_port?.toString()||"",allow_public_bind:!!e.allow_public_bind,ssh_host:e.ssh_host||"",ssh_port:e.ssh_port?.toString()||"22",username:e.username||"",auth_type:e.auth_type||"password",password:"",private_key_path:e.private_key_path||"",private_key_passphrase:"",clear_private_key_passphrase:!1,strict_host_key_checking:!!e.strict_host_key_checking,host_key_fingerprint:e.host_key_fingerprint||"",connect_timeout_ms:e.connect_timeout_ms?.toString()||"",keepalive_interval_ms:e.keepalive_interval_ms?.toString()||"",backoff_base_ms:e.backoff_base_ms?.toString()||"",backoff_max_ms:e.backoff_max_ms?.toString()||"",scan_interval_ms:e.scan_interval_ms?.toString()||"",debounce_ms:e.debounce_ms?.toString()||"",exclude_ports_text:e.exclude_ports?.join(", ")||""})):(M(null),z({...v,mode:P})),T(!0)};return k?N?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-black",children:"TCP 穿透"}),(0,s.jsx)("p",{className:"text-slate-500 mt-1",children:"管理 SSH 反向隧道"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-lg p-1",children:[(0,s.jsx)(r.Button,{variant:"single"===P?"primary":"ghost",size:"sm",onClick:()=>H("single"),children:"单穿透"}),(0,s.jsx)(r.Button,{variant:"full"===P?"primary":"ghost",size:"sm",onClick:()=>H("full"),children:"全穿透"})]}),(0,s.jsxs)(r.Button,{onClick:()=>U(),children:[(0,s.jsx)(d.Plus,{className:"w-4 h-4"}),"添加隧道"]})]})]}),(0,s.jsxs)("div",{className:"grid gap-4",children:[E.map(e=>{let a=e.enabled??"forwarding"===e.status.state;return(0,s.jsx)(t.Card,{className:"p-4",hoverEffect:!0,children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(0,s.jsx)("span",{className:"font-bold",children:e.name||e.id}),(0,s.jsx)(l.Badge,{variant:"full"===e.mode?"primary":"info",children:"full"===e.mode?"全穿透":"单穿透"}),(0,s.jsx)(l.Badge,{variant:"forwarding"===e.status.state?"success":"connecting"===e.status.state?"warning":"error"===e.status.state?"error":"default",children:e.status.state}),"0.0.0.0"===e.remote_bind_addr&&(0,s.jsx)(l.Badge,{variant:"error",children:"公网"})]}),(0,s.jsxs)("div",{className:"text-sm text-slate-500",children:["full"===e.mode?(0,s.jsxs)("p",{children:["远程监听: ",e.remote_bind_addr,"（同端口映射）"]}):(0,s.jsxs)("p",{children:["远程监听: ",e.remote_bind_addr,":",e.remote_port," → 本地: ",e.local_addr,":",e.local_port]}),(0,s.jsxs)("p",{children:["SSH: ",e.username,"@",e.ssh_host,":",e.ssh_port,(0,s.jsxs)("span",{className:"ml-2",children:["连接: ",e.status.active_conns]})]})]}),e.status.last_error&&(0,s.jsxs)("p",{className:"text-sm text-red-500 mt-1",children:[e.status.last_error.code,": ",e.status.last_error.message]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.Button,{variant:"secondary",size:"sm",onClick:()=>R(e),children:[(0,s.jsx)(_.RefreshCw,{className:"w-4 h-4"}),"重启"]}),(0,s.jsx)(r.Button,{variant:"secondary",size:"sm",onClick:()=>L(e),children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Square,{className:"w-4 h-4"}),"停止"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Play,{className:"w-4 h-4"}),"启动"]})}),(0,s.jsxs)(r.Button,{variant:"secondary",size:"sm",onClick:()=>F(e),children:[(0,s.jsx)(u.Activity,{className:"w-4 h-4"}),"测试"]}),(0,s.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>U(e),children:[(0,s.jsx)(g.Pencil,{className:"w-4 h-4"}),"编辑"]}),(0,s.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>O(e),children:[(0,s.jsx)(x,{className:"w-4 h-4"}),"复制"]}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>V(e.id),children:(0,s.jsx)(h.Trash2,{className:"w-4 h-4 text-red-500"})})]})]})},e.id)}),0===E.length&&(0,s.jsx)(t.Card,{className:"p-12 text-center",children:(0,s.jsx)("p",{className:"text-slate-500",children:"暂无 TCP 穿透配置"})})]}),(0,s.jsx)(n.Modal,{isOpen:S,onClose:()=>T(!1),title:I?"编辑隧道":"添加隧道",size:"lg",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(i.Input,{label:"名称",placeholder:"例如: 远程暴露本地 8080",value:B.name,onChange:e=>z({...B,name:e.target.value})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600 pt-7",children:[(0,s.jsx)("input",{type:"checkbox",checked:B.enabled,onChange:e=>z({...B,enabled:e.target.checked})}),B.enabled?"已启用":"未启用"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"模式"}),(0,s.jsxs)("select",{value:B.mode,onChange:e=>z({...B,mode:e.target.value}),className:"w-full h-11 px-4 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none",children:[(0,s.jsx)("option",{value:"single",children:"单穿透"}),(0,s.jsx)("option",{value:"full",children:"全穿透"})]})]}),(0,s.jsx)(i.Input,{label:"SSH 端口",type:"number",value:B.ssh_port,onChange:e=>z({...B,ssh_port:e.target.value})})]}),"single"===B.mode?(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsx)(i.Input,{label:"本地目标地址",placeholder:"127.0.0.1",value:B.local_addr,onChange:e=>z({...B,local_addr:e.target.value})}),(0,s.jsx)(i.Input,{label:"本地端口",type:"number",value:B.local_port,onChange:e=>z({...B,local_port:e.target.value})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"远程监听地址"}),(0,s.jsxs)("select",{value:B.remote_bind_addr,onChange:e=>z({...B,remote_bind_addr:e.target.value}),className:"w-full h-11 px-4 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none",children:[(0,s.jsx)("option",{value:"127.0.0.1",children:"127.0.0.1（仅远程本机）"}),(0,s.jsx)("option",{value:"0.0.0.0",children:"0.0.0.0（公网暴露）"})]})]}),(0,s.jsx)(i.Input,{label:"远程端口",type:"number",value:B.remote_port,onChange:e=>z({...B,remote_port:e.target.value})})]}):(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"远程监听地址"}),(0,s.jsxs)("select",{value:B.remote_bind_addr,onChange:e=>z({...B,remote_bind_addr:e.target.value}),className:"w-full h-11 px-4 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none",children:[(0,s.jsx)("option",{value:"127.0.0.1",children:"127.0.0.1（仅远程本机）"}),(0,s.jsx)("option",{value:"0.0.0.0",children:"0.0.0.0（公网暴露）"})]})]}),(0,s.jsx)(i.Input,{label:"扫描间隔 (ms)",type:"number",value:B.scan_interval_ms,onChange:e=>z({...B,scan_interval_ms:e.target.value})}),(0,s.jsx)(i.Input,{label:"删除防抖 (ms)",type:"number",value:B.debounce_ms,onChange:e=>z({...B,debounce_ms:e.target.value})})]}),"single"===B.mode&&"0.0.0.0"===B.remote_bind_addr&&(0,s.jsxs)(t.Card,{className:"border border-red-200 bg-red-50 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-red-700 font-semibold mb-2",children:"风险提示：公网暴露"}),(0,s.jsx)("p",{className:"text-sm text-red-600",children:"该配置会把远程服务器端口暴露到公网，请确认远程 sshd 启用 GatewayPorts，并配置防火墙/安全组。"}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-red-700 mt-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:B.allow_public_bind,onChange:e=>z({...B,allow_public_bind:e.target.checked})}),"我理解风险并允许公网监听"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsx)(i.Input,{label:"SSH 主机",placeholder:"example.com",value:B.ssh_host,onChange:e=>z({...B,ssh_host:e.target.value})}),(0,s.jsx)(i.Input,{label:"SSH 端口",type:"number",value:B.ssh_port,onChange:e=>z({...B,ssh_port:e.target.value})}),(0,s.jsx)(i.Input,{label:"用户名",placeholder:"root",value:B.username,onChange:e=>z({...B,username:e.target.value})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"认证方式"}),(0,s.jsxs)("select",{value:B.auth_type,onChange:e=>z({...B,auth_type:e.target.value}),className:"w-full h-11 px-4 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none",children:[(0,s.jsx)("option",{value:"password",children:"Password"}),(0,s.jsx)("option",{value:"private_key_path",children:"Private Key Path"})]})]}),"password"===B.auth_type?(0,s.jsx)(i.Input,{label:"密码",placeholder:"留空使用 ~/.ssh 密钥",value:B.password,onChange:e=>z({...B,password:e.target.value})}):(0,s.jsx)(i.Input,{label:"私钥路径",placeholder:"/root/.ssh/id_ed25519",value:B.private_key_path,onChange:e=>z({...B,private_key_path:e.target.value})})]}),"private_key_path"===B.auth_type&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Input,{label:"私钥口令（可选）",type:"password",placeholder:I?"留空保持不变":"无口令留空",value:B.private_key_passphrase,onChange:e=>z({...B,private_key_passphrase:e.target.value})}),I&&(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,s.jsx)("input",{type:"checkbox",checked:B.clear_private_key_passphrase,onChange:e=>z({...B,clear_private_key_passphrase:e.target.checked})}),"清空口令"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600 pt-7",children:[(0,s.jsx)("input",{type:"checkbox",checked:B.strict_host_key_checking,onChange:e=>z({...B,strict_host_key_checking:e.target.checked})}),"严格校验主机指纹"]}),(0,s.jsx)(i.Input,{label:"HostKey 指纹（SHA256:...）",placeholder:"SHA256:xxxx",value:B.host_key_fingerprint,onChange:e=>z({...B,host_key_fingerprint:e.target.value})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsx)(i.Input,{label:"连接超时 (ms)",type:"number",value:B.connect_timeout_ms,onChange:e=>z({...B,connect_timeout_ms:e.target.value})}),(0,s.jsx)(i.Input,{label:"Keepalive (ms)",type:"number",value:B.keepalive_interval_ms,onChange:e=>z({...B,keepalive_interval_ms:e.target.value})}),(0,s.jsx)(i.Input,{label:"重连 base (ms)",type:"number",value:B.backoff_base_ms,onChange:e=>z({...B,backoff_base_ms:e.target.value})}),(0,s.jsx)(i.Input,{label:"重连 max (ms)",type:"number",value:B.backoff_max_ms,onChange:e=>z({...B,backoff_max_ms:e.target.value})})]}),"full"===B.mode&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"不穿透端口黑名单（逗号/空格/换行分隔）"}),(0,s.jsx)("textarea",{value:B.exclude_ports_text,onChange:e=>z({...B,exclude_ports_text:e.target.value}),rows:3,className:"w-full px-4 py-3 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",placeholder:"例如: 80, 443, 3000"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,s.jsx)(r.Button,{variant:"secondary",onClick:()=>T(!1),children:"取消"}),(0,s.jsx)(r.Button,{onClick:q,loading:b,children:"保存"})]})]})})]}):(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-slate-500",children:"当前版本未启用 tcp_tunnel 特性"})})}):(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-600/30 border-t-indigo-600 rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-slate-500",children:"加载中..."})]})})}e.s(["default",()=>b],94199)}]);