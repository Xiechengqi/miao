(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14346,65309,e=>{"use strict";var s=e.i(98631);let a=(0,s.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>a],14346);let t=(0,s.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],65309)},14136,e=>{"use strict";let s=(0,e.i(98631).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],14136)},43293,611,e=>{"use strict";var s=e.i(98631);let a=(0,s.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],43293);let t=(0,s.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>t],611)},66974,e=>{"use strict";let s=(0,e.i(98631).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],66974)},83409,e=>{"use strict";var s=e.i(87519),a=e.i(86646);e.i(16787);var t=e.i(26791),l=e.i(2163),i=e.i(63917),n=e.i(67559),r=e.i(50736),c=e.i(1257),d=e.i(9165),o=e.i(75157),m=e.i(5482),p=e.i(43293),h=e.i(66974),u=e.i(14346),x=e.i(65309),g=e.i(14136),v=e.i(611);let j={name:"",enabled:!0,vnc_session_id:"",display:"",command:""};function f(){let{setLoading:e,loading:f,addToast:y}=(0,c.useStore)(),[b,N]=(0,a.useState)([]),[w,k]=(0,a.useState)(!1),[_,C]=(0,a.useState)(!1),[S,A]=(0,a.useState)(null),[M,P]=(0,a.useState)(j),[E,B]=(0,a.useState)(""),[z,I]=(0,a.useState)(""),[L,T]=(0,a.useState)(!0),[V,F]=(0,a.useState)(""),[O,U]=(0,a.useState)([]),[Y,q]=(0,a.useState)([]);(0,a.useEffect)(()=>{D(),K(),R()},[]);let D=async()=>{try{let e=await d.api.getApps();N(e),k(!0)}catch(e){console.error("Failed to load apps:",e),k(!0)}},K=async()=>{try{let e=await d.api.getAppTemplates();U(e.templates||[])}catch(e){console.error("Failed to load app templates:",e)}},R=async()=>{try{let e=await d.api.getVncSessions();q(e)}catch(e){console.error("Failed to load VNC sessions:",e)}},$=(0,a.useMemo)(()=>{let e=new Map;return Y.forEach(s=>{e.set(s.id,s)}),e},[Y]),H=e=>e?Object.entries(e).map(([e,s])=>`${e}=${s}`).join("\n"):"",W=e=>{e?(A(e.id),P({name:e.name||"",enabled:e.enabled??!0,vnc_session_id:e.vnc_session_id||"",display:e.display||"",command:e.command||""}),B((e.args||[]).join(" ")),I(H(e.env))):(A(null),P(j),B(""),I("")),T(!0),F(""),C(!0)},G=async()=>{e(!0,"save");try{let e=(M.vnc_session_id||"").trim(),s={name:M.name.trim()||null,enabled:!!M.enabled,vnc_session_id:e,display:e?"":M.display.trim(),command:M.command.trim(),args:E?E.split(/\s+/).map(e=>e.trim()).filter(e=>e.length>0):[],env:(e=>{let s={};if(!e)return s;for(let a of e.split("\n")){let e=a.trim();if(!e)continue;let t=e.indexOf("=");if(t<0)s[e]="";else{let a=e.slice(0,t).trim(),l=e.slice(t+1);a&&(s[a]=l)}}return s})(z),restart:!!S&&L&&!!M.enabled};S?(await d.api.updateApp(S,s),y({type:"success",message:"应用已更新"})):(await d.api.createApp(s),y({type:"success",message:"应用已添加"})),C(!1),A(null),P(j),B(""),I(""),T(!0),F(""),D()}catch(e){y({type:"error",message:e instanceof Error?e.message:"操作失败"})}finally{e(!1)}},J=async s=>{let a=s.enabled??s.status.running;e(!0,a?"stop":"start");try{a?(await d.api.stopApp(s.id),y({type:"success",message:"应用已停止"})):(await d.api.startApp(s.id),y({type:"success",message:"应用已启动"})),D()}catch(e){y({type:"error",message:e instanceof Error?e.message:"操作失败"})}finally{e(!1)}},Q=async s=>{e(!0,"restart");try{await d.api.restartApp(s.id),y({type:"success",message:"应用已重启"}),D()}catch(e){y({type:"error",message:e instanceof Error?e.message:"重启失败"})}finally{e(!1)}},X=async s=>{if(confirm(`确定删除 ${s.name||s.id}？`)){e(!0,"delete");try{await d.api.deleteApp(s.id),y({type:"success",message:"应用已删除"}),D()}catch(e){y({type:"error",message:e instanceof Error?e.message:"删除失败"})}finally{e(!1)}}};return w?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-black",children:"应用"}),(0,s.jsx)("p",{className:"text-slate-500 mt-1",children:"管理浏览器和应用"})]}),(0,s.jsxs)(l.Button,{onClick:()=>W(),children:[(0,s.jsx)(p.Plus,{className:"w-4 h-4"}),"添加应用"]})]}),(0,s.jsxs)("div",{className:"grid gap-4",children:[b.map(e=>{let a=e.enabled??e.status.running;return(0,s.jsx)(t.Card,{className:"p-4",hoverEffect:!0,children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg bg-sky-600/10 flex items-center justify-center",children:(0,s.jsx)(m.AppWindow,{className:"w-5 h-5 text-sky-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-bold",children:e.name||e.id}),(0,s.jsx)(i.Badge,{variant:e.status.running?"success":"default",children:e.status.running?"running":"stopped"})]}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:["DISPLAY: ",(e.vnc_session_id?$.get(e.vnc_session_id)?.display||"":e.display||"")||"-",e.vnc_session_id&&(0,s.jsxs)("span",{children:[" · 绑定: ",(e=>{if(!e.vnc_session_id)return"";let s=$.get(e.vnc_session_id);return s?s.name||s.id:e.vnc_session_id})(e)]})]}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:["命令: ",e.command||"-"," ",e.args?.join(" ")]}),e.status.running&&(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:["PID: ",e.status.pid||"-"," · 运行: ",(0,o.formatUptime)(e.status.uptime_secs)]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(l.Button,{variant:"secondary",size:"sm",onClick:()=>Q(e),children:[(0,s.jsx)(h.RefreshCw,{className:"w-4 h-4"}),"重启"]}),(0,s.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:()=>J(e),children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Square,{className:"w-4 h-4"}),"停止"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Play,{className:"w-4 h-4"}),"启动"]})}),(0,s.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>W(e),children:[(0,s.jsx)(v.Pencil,{className:"w-4 h-4"}),"编辑"]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>X(e),children:(0,s.jsx)(g.Trash2,{className:"w-4 h-4 text-red-500"})})]})]})},e.id)}),0===b.length&&(0,s.jsx)(t.Card,{className:"p-12 text-center",children:(0,s.jsx)("p",{className:"text-slate-500",children:"暂无应用配置"})})]}),(0,s.jsx)(n.Modal,{isOpen:_,onClose:()=>C(!1),title:S?"编辑应用":"添加应用",size:"lg",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"模板预设"}),(0,s.jsxs)("select",{value:V,onChange:e=>{let s=e.target.value;F(s),(e=>{if(!e)return;let s=O.find(s=>s.id===e);s&&(M.name?P({...M,command:s.command||""}):P({...M,name:s.name||"",command:s.command||""}),B((s.args||[]).join(" ")),I(H(s.env)))})(s)},className:"w-full h-11 px-4 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none",children:[(0,s.jsx)("option",{value:"",children:"手动配置"}),O.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsx)(r.Input,{label:"名称",placeholder:"例如: Chromium",value:M.name,onChange:e=>P({...M,name:e.target.value})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600 pt-7",children:[(0,s.jsx)("input",{type:"checkbox",checked:M.enabled,onChange:e=>P({...M,enabled:e.target.checked})}),M.enabled?"已启用":"未启用"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"绑定 VNC 会话"}),(0,s.jsxs)("select",{value:M.vnc_session_id,onChange:e=>P({...M,vnc_session_id:e.target.value}),className:"w-full h-11 px-4 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none",children:[(0,s.jsx)("option",{value:"",children:"不绑定（手动 DISPLAY）"}),Y.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name||e.id," (",e.display,")"]},e.id))]})]}),(0,s.jsx)(r.Input,{label:"DISPLAY",placeholder:":10",value:M.display,onChange:e=>P({...M,display:e.target.value}),disabled:!!M.vnc_session_id})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(r.Input,{label:"启动命令",placeholder:"chromium",value:M.command,onChange:e=>P({...M,command:e.target.value})}),(0,s.jsx)(r.Input,{label:"命令参数",placeholder:"--no-sandbox",value:E,onChange:e=>B(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"环境变量 (KEY=VALUE，每行一个)"}),(0,s.jsx)("textarea",{value:z,onChange:e=>I(e.target.value),rows:4,className:"w-full px-4 py-3 rounded-lg bg-white border border-slate-200 shadow-sm border-0 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",placeholder:"KEY=VALUE"})]}),S&&(0,s.jsx)("div",{className:"flex flex-col gap-2 text-sm text-slate-600",children:(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:L,onChange:e=>T(e.target.checked)}),"保存后重启"]})}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,s.jsx)(l.Button,{variant:"secondary",onClick:()=>C(!1),children:"取消"}),(0,s.jsx)(l.Button,{onClick:G,loading:f,children:"保存"})]})]})})]}):(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-600/30 border-t-indigo-600 rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-slate-500",children:"加载中..."})]})})}e.s(["default",()=>f])}]);