(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14136,e=>{"use strict";let s=(0,e.i(98631).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],14136)},43293,611,e=>{"use strict";var s=e.i(98631);let a=(0,s.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],43293);let t=(0,s.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>t],611)},14346,65309,e=>{"use strict";var s=e.i(98631);let a=(0,s.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>a],14346);let t=(0,s.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],65309)},5300,e=>{"use strict";let s=(0,e.i(98631).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>s],5300)},24576,e=>{"use strict";var s=e.i(87519),a=e.i(86646);e.i(16787);var t=e.i(26791),l=e.i(2163),r=e.i(63917),n=e.i(67559),i=e.i(50736),c=e.i(1257),d=e.i(9165),o=e.i(43293),h=e.i(14136),m=e.i(611),x=e.i(5300),u=e.i(14346),p=e.i(65309);let g={name:"",enabled:!0,local_paths_text:"",remote_path:"",ssh_host:"",ssh_port:"22",username:"",password:"",delete:!1,verify:!1,compress:!1,watch:!1,bwlimit:"",parallel:"",exclude_text:"",include_text:"",extra_args_text:"",schedule_enabled:!1,schedule_cron:"",schedule_timezone:"Asia/Shanghai"};function j(){let{setLoading:e,loading:j,addToast:b}=(0,c.useStore)(),[y,f]=(0,a.useState)([]),[v,_]=(0,a.useState)(!1),[N,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)(null),[S,z]=(0,a.useState)(g),B=(0,a.useMemo)(()=>S.local_paths_text.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),[S.local_paths_text]),M=(0,a.useMemo)(()=>!!S.ssh_host.trim()&&!!S.username.trim()&&0!==B.length&&(!S.schedule_enabled||!!S.schedule_cron.trim()),[S,B]);(0,a.useEffect)(()=>{I()},[]);let I=async()=>{try{let e=await d.api.getSyncs();f(e)}catch(e){b({type:"error",message:"获取备份配置失败"})}finally{_(!0)}},A=()=>{z(g)},P=e=>{e?(C(e.id),z({name:e.name||"",enabled:e.enabled,local_paths_text:(e.local_paths||[]).join("\n"),remote_path:e.remote_path||"",ssh_host:e.ssh.host||"",ssh_port:e.ssh.port?.toString()||"22",username:e.ssh.username||"",password:e.auth?.password||"",delete:!!e.options?.delete,verify:!!e.options?.verify,compress:!!e.options?.compress,watch:!!e.options?.watch,bwlimit:e.options?.bwlimit||"",parallel:e.options?.parallel?.toString()||"",exclude_text:(e.options?.exclude||[]).join("\n"),include_text:(e.options?.include||[]).join("\n"),extra_args_text:(e.options?.extra_args||[]).join(" "),schedule_enabled:!!e.schedule?.enabled,schedule_cron:e.schedule?.cron||"",schedule_timezone:e.schedule?.timezone||"Asia/Shanghai"})):(C(null),A()),w(!0)},E=()=>{w(!1),C(null),A()},T=async()=>{if(M){e(!0,"sync-save");try{let e=B.length>1?null:(S.remote_path||"").trim()||null,s=S.schedule_cron.trim(),a=S.schedule_timezone.trim()||"Asia/Shanghai",t=S.schedule_enabled?{enabled:!0,cron:s,timezone:a}:{enabled:!1},l={name:S.name.trim()||null,enabled:!!S.enabled,local_paths:B,remote_path:e,ssh:{host:S.ssh_host.trim(),port:Number(S.ssh_port)||22,username:S.username.trim()},auth:{type:"password",password:S.password.trim()||null},options:{delete:!!S.delete,verify:!!S.verify,compress:!!S.compress,bwlimit:S.bwlimit.trim()||null,exclude:S.exclude_text.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),include:S.include_text.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),parallel:S.parallel?Number(S.parallel):null,watch:!!S.watch,extra_args:S.extra_args_text.trim().split(/\s+/).filter(Boolean)},schedule:t};k?(await d.api.updateSync(k,l),b({type:"success",message:"备份配置已更新"})):(await d.api.createSync(l),b({type:"success",message:"备份配置已添加"})),E(),I()}catch(e){b({type:"error",message:e instanceof Error?e.message:"保存失败"})}finally{e(!1)}}},q=async s=>{e(!0,"sync-toggle");try{let e=!!s.schedule?.enabled,a=s.status?.state==="running",t=e?s.enabled:a;t?await d.api.stopSync(s.id):await d.api.startSync(s.id),b({type:"success",message:t?"备份已停止":"备份已启动"}),I()}catch(e){b({type:"error",message:e instanceof Error?e.message:"操作失败"})}finally{e(!1)}},F=async s=>{e(!0,"sync-test");try{await d.api.testSync(s.id),b({type:"success",message:"备份 dry-run 已启动"}),I()}catch(e){b({type:"error",message:e instanceof Error?e.message:"测试失败"})}finally{e(!1)}},H=async s=>{if(confirm(`确定要删除 ${s.name||s.id} 吗？`)){e(!0,"sync-delete");try{await d.api.deleteSync(s.id),b({type:"success",message:"备份配置已删除"}),I()}catch(e){b({type:"error",message:e instanceof Error?e.message:"删除失败"})}finally{e(!1)}}};return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)(t.Card,{className:"p-6",hoverEffect:!1,children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"备份同步"}),(0,s.jsx)("p",{className:"text-slate-500 text-sm mt-1",children:"使用 sy 同步文件到远程"})]}),(0,s.jsxs)(l.Button,{onClick:()=>P(),children:[(0,s.jsx)(o.Plus,{className:"w-4 h-4"}),"添加备份"]})]}),(0,s.jsx)("div",{className:"mt-6",children:v?0===y.length?(0,s.jsx)("div",{className:"text-center py-8 text-slate-500",children:"暂无备份配置"}):(0,s.jsx)("div",{className:"space-y-3",children:y.map(e=>{var a;return(0,s.jsxs)("div",{className:"flex flex-col gap-3 rounded-lg border border-slate-100 bg-white px-4 py-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-900",children:e.name||e.id}),(0,s.jsx)(r.Badge,{variant:e.status?.state==="running"?"success":e.status?.state==="error"?"error":"default",children:e.status?.state||"idle"}),e.schedule?.enabled&&(0,s.jsx)(r.Badge,{variant:"warning",children:"cron"})]}),(0,s.jsxs)("div",{className:"text-sm text-slate-500 mt-1",children:["本地: ",(a=e.local_paths).length?a.join(", "):"-"]}),(0,s.jsxs)("div",{className:"text-sm text-slate-500 mt-1",children:["远程: ",e.ssh.username,"@",e.ssh.host,":",e.ssh.port]}),(0,s.jsxs)("div",{className:"text-sm text-slate-500 mt-1",children:["远程路径: ",e.remote_path||"跟随本地"]}),e.schedule?.cron&&(0,s.jsxs)("div",{className:"text-sm text-slate-500 mt-1",children:["定时: ",e.schedule.cron," (",e.schedule.timezone||"Asia/Shanghai",")"]}),e.status?.last_error&&(0,s.jsx)("div",{className:"text-sm text-red-500 mt-1",children:e.status.last_error.message})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)(l.Button,{variant:"secondary",size:"sm",onClick:()=>F(e),loading:j,children:[(0,s.jsx)(x.Zap,{className:"w-4 h-4"}),"测试"]}),(0,s.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:()=>q(e),loading:j,children:e.schedule?.enabled?e.enabled?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Square,{className:"w-4 h-4"}),"停止"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Play,{className:"w-4 h-4"}),"启动"]}):e.status?.state==="running"?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Square,{className:"w-4 h-4"}),"停止"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Play,{className:"w-4 h-4"}),"启动"]})}),(0,s.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>P(e),children:[(0,s.jsx)(m.Pencil,{className:"w-4 h-4"}),"编辑"]}),(0,s.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>H(e),children:[(0,s.jsx)(h.Trash2,{className:"w-4 h-4 text-red-500"}),"删除"]})]})]},e.id)})}):(0,s.jsxs)("div",{className:"text-center py-10",children:[(0,s.jsx)("div",{className:"w-10 h-10 border-4 border-indigo-600/30 border-t-indigo-600 rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-slate-500",children:"加载中..."})]})})]}),(0,s.jsx)(n.Modal,{isOpen:N,onClose:E,title:k?"编辑备份":"添加备份",size:"lg",children:(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,s.jsx)(i.Input,{label:"名称（可选）",placeholder:"例如: 备份主目录",value:S.name,onChange:e=>z({...S,name:e.target.value})}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.enabled,onChange:e=>z({...S,enabled:e.target.checked})}),S.enabled?"已启用":"未启用"]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"本地路径（多行）"}),(0,s.jsx)("textarea",{className:"w-full min-h-[120px] rounded-lg border border-slate-200 px-4 py-3 text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",value:S.local_paths_text,onChange:e=>z({...S,local_paths_text:e.target.value}),placeholder:"/data /var/log/app.log"}),(0,s.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:[B.length," 项 · 多路径时远程路径固定为本地路径"]})]}),(0,s.jsx)(i.Input,{label:"远程路径（可选）",placeholder:"留空则与本地相同",value:S.remote_path,disabled:B.length>1,onChange:e=>z({...S,remote_path:e.target.value})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,s.jsx)(i.Input,{label:"SSH Host",placeholder:"example.com",value:S.ssh_host,onChange:e=>z({...S,ssh_host:e.target.value})}),(0,s.jsx)(i.Input,{label:"端口",type:"number",value:S.ssh_port,onChange:e=>z({...S,ssh_port:e.target.value})}),(0,s.jsx)(i.Input,{label:"用户名",placeholder:"root",value:S.username,onChange:e=>z({...S,username:e.target.value})})]}),(0,s.jsx)(i.Input,{label:"密码（可选）",placeholder:"留空会改为使用 ~/.ssh 密钥",value:S.password,onChange:e=>z({...S,password:e.target.value})}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"远端必须安装 sy（包含 sy-remote），不校验主机指纹；密码留空时会使用本机 ~/.ssh 下的密钥。"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"同步选项"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-slate-600",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.delete,onChange:e=>z({...S,delete:e.target.checked})}),"删除远端多余文件"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.verify,onChange:e=>z({...S,verify:e.target.checked})}),"写后校验"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.compress,onChange:e=>z({...S,compress:e.target.checked})}),"压缩传输"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.watch,onChange:e=>z({...S,watch:e.target.checked})}),"监听模式"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,s.jsx)(i.Input,{label:"带宽限制",placeholder:"例如: 1MB",value:S.bwlimit,onChange:e=>z({...S,bwlimit:e.target.value})}),(0,s.jsx)(i.Input,{label:"并行数",type:"number",value:S.parallel,onChange:e=>z({...S,parallel:e.target.value})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"排除规则（多行）"}),(0,s.jsx)("textarea",{className:"w-full min-h-[120px] rounded-lg border border-slate-200 px-4 py-3 text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",value:S.exclude_text,onChange:e=>z({...S,exclude_text:e.target.value}),placeholder:"*.log node_modules/"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"包含规则（多行）"}),(0,s.jsx)("textarea",{className:"w-full min-h-[120px] rounded-lg border border-slate-200 px-4 py-3 text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",value:S.include_text,onChange:e=>z({...S,include_text:e.target.value}),placeholder:"important.txt"})]})]}),(0,s.jsx)(i.Input,{label:"额外参数",placeholder:"--dry-run 不需要配置",value:S.extra_args_text,onChange:e=>z({...S,extra_args_text:e.target.value})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.schedule_enabled,onChange:e=>z({...S,schedule_enabled:e.target.checked})}),S.schedule_enabled?"定时已启用":"定时未启用"]})}),(0,s.jsx)(i.Input,{label:"Cron 表达式",placeholder:"0 2 * * *",value:S.schedule_cron,onChange:e=>z({...S,schedule_cron:e.target.value})}),(0,s.jsx)(i.Input,{label:"时区",placeholder:"Asia/Shanghai",value:S.schedule_timezone,onChange:e=>z({...S,schedule_timezone:e.target.value})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-end gap-3 pt-2",children:[(0,s.jsx)(l.Button,{variant:"secondary",onClick:E,children:"取消"}),(0,s.jsx)(l.Button,{onClick:T,loading:j,disabled:!M,children:"保存配置"})]})]})})]})}e.s(["default",()=>j])}]);