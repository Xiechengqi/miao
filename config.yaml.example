# Miao Configuration Example
#
# Tip: If `config.yaml` is missing, open http://localhost:6161 to initialize
# (set login password) and miao will generate `config.yaml` automatically.

# HTTP API port (optional, default: 6161)
# port: 6161

# Web login password (optional, default: "admin")
# password: admin

# Web terminals (gotty) (optional)
# terminals:
#   - id: "term-1"
#     name: "主终端"
#     enabled: false
#     addr: "127.0.0.1"
#     port: 7681
#     command: "/bin/bash"
#     # command_args:
#     #   - "-l"
#     # auth_username: "admin"
#     # auth_password: "changeme"
#     # 留空 auth_username/auth_password 将保持现有认证不变（清空请在面板勾选“清除认证”）
#     # extra_args:
#     #   - "-w"
#     #   - "--enable-idle-alert"

# Remembered node selections (optional)
# Key is selector group name, value is selected node name.
# selections:
#   proxy: "节点名"

# sing-box home directory (optional)
# If not specified, miao will use embedded sing-box binary
# and extract it to ./runtime directory
# sing_box_home: /home/alice/pros/miao/sing-box

# Subscription files are loaded from ./sub by default (or `--sub <path>`).
# Put subscription files in that directory and reload from the Web UI.

# Manual nodes in JSON format (optional)
nodes:
  # - '{"type":"hysteria2","tag":"my-node","server":"example.com","server_port":443,"password":"xxx"}'

# DNS auto failover (optional)
# Active DNS server tag used in sing-box `dns.final`.
# dns_active: doh-cf
#
# Candidate tags for health checks / failover.
# Miao will fallback to `doh-cf` when all candidates fail (it won't auto-switch to `dns-direct`).
# dns_candidates:
#   - doh-cf
#   - doh-google
#   # If you want to use UDP DNS (IP DNS), run a local DNS forwarder and point sing-box to it (see README).
#
# Health check interval and thresholds (milliseconds).
# dns_check_interval_ms: 300000
# dns_fail_threshold: 5
# dns_cooldown_ms: 600000

# Proxy multi-select & auto failover (optional)
# Selected candidate nodes (ordered by priority). When there are 2+ candidates,
# miao will periodically check https://3.0.3.0/ips and fail over on repeated failures.
# proxy_pool:
#   - "节点A"
#   - "节点B"
#
# proxy_monitor_enabled: true
# proxy_check_interval_ms: 180000
# proxy_check_timeout_ms: 3000
# proxy_fail_threshold: 3
# proxy_window_size: 10
# proxy_window_fail_rate: 0.6
# proxy_pause_ms: 60000

# IPv6 note:
# Miao enables sing-box TUN with an IPv6 ULA prefix by default (fd00:172:18::1/126) to avoid IPv6 being blocked by strict routing rules.
# DNS strategy is still prefer_ipv4 by default, so IPv6 will mainly be used when necessary.

# TCP reverse tunneling via SSH (-R) (optional)
# Note:
# - remote_port must be explicit (no auto allocation). Port conflict will be marked as error.
# - Default remote_bind_addr is 127.0.0.1 (remote localhost only).
# - To expose publicly (0.0.0.0), you must set allow_public_bind: true and configure sshd GatewayPorts.
# - On update from the Web UI, leaving password/passphrase blank keeps the existing value.
#
# tcp_tunnels:
#   - id: "t1"
#     name: "Expose local 8080"
#     enabled: true
#     local_addr: "127.0.0.1"
#     local_port: 8080
#     remote_bind_addr: "0.0.0.0"   # or 127.0.0.1
#     remote_port: 18080
#     allow_public_bind: true
#     ssh_host: "example.com"
#     ssh_port: 22
#     username: "root"
#     auth:
#       type: "password"
#       password: "your-password"
#       # or:
#       # type: "private_key_path"
#       # path: "/root/.ssh/id_ed25519"
#       # passphrase: ""
#     strict_host_key_checking: true
#     host_key_fingerprint: "SHA256:xxxx"
#     connect_timeout_ms: 5000
#     keepalive_interval_ms: 10000
#     reconnect_backoff_ms:
#       base_ms: 1000
#       max_ms: 30000

# Full tunnel sets (optional)
# It scans local TCP LISTEN ports (tcp only) via `ss -plunt` (fallback `netstat -anltp`),
# auto-creates per-port tunnels to the given SSH host (remote_port = local_port),
# and deletes tunnels when the port disappears for longer than debounce_ms.
#
# tcp_tunnel_sets:
#   - id: "s-xxx"
#     name: "All ports to VPS"
#     enabled: true
#     remote_bind_addr: "0.0.0.0"
#     ssh_host: "example.com"
#     ssh_port: 22
#     username: "root"
#     auth:
#       type: "password"
#       password: "your-password"
#     strict_host_key_checking: true
#     host_key_fingerprint: "SHA256:xxxx"
#     exclude_ports: [443, 6161]
#     scan_interval_ms: 3000
#     debounce_ms: 8000
#     connect_timeout_ms: 10000
#     start_batch_size: 5
#     start_batch_interval_ms: 500
